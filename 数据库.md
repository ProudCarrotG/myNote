# sql语言
>代码中[ ]表示内容可以缺省

><>不可缺省
## opengauss

*   启动虚拟机
*   登录虚拟机(root和密码)
*   查询虚拟机本地ip地址`ifconfig`
*   使用`ssh`软件连接虚拟机
    *   登陆时需要虚拟机`root`密码

*   `su - omm`登录数据库主节点, 

*   `gs_om -t start`启动服务
    *   `gs_om -t stop`停止服务
*   gsql -d postgres -p 2600 -r`连接数据库`
    *   `postgres`为默认生成的数据库. `26000`为数据库主节点端口号(根据`openGauss`的实际情况替换)
*   

​	





## 数据定义

-----------------
### 模式
```sql
要定义模式需要拥有数据库管理员权限
模式包含有表,视图,索引(类似于c中的命名空间)
```

#### 定义模式
```sql
CREATE SCHEME <模式名> AUTHORIZATION <用户名>**
```

#### 删除模式
```sql
DROP SCHEME <模式名> <CASCADE|RESTRICT>
```
CASCADE:模式下数据库对象一并删除

RESTRICT:如果模式下存在数据库对象则无法删除


----------------------
### 表
#### 定义表
```SQL
CREATE TABLE <表名> (
    <列名> <数据类型> [列级完整性约束条件],
    ...,
    [表级完整性约束条件]
);
```

#### 数据类型
- CHAR(n)       长度为n的字符串
- VARCHAR(n)    最大长度为n的变长字符串
- INT           长整型(4字节)
- SMALLINT      短整型(2
- BIGINT        大整形(8
- FLOAT(n)      可选精度的浮点数,精度至少为n位数字
- DATA          日期 格式为YYYY-MM-DD

#### 修改表
```SQL
ALTER TABLE <表名>
    -- ADD是向表中添加信息 --
    ADD <新列名> <数据类型> [列约束]
    ADD <表级约束>

    -- 删除 --
    DROP <列名>
    DROP CONSTRAINT <完整性约束条件>

    -- 修改原有的列的定义,包括修改列名和数据类型 --
    ALTER COLUMN <列名> <数据类型>
```

#### 删除表
```sql
DROP TABLE <表名> [RESTRICT|CASCADE]
```

### 索引
索引能够加快查找速度
```sql
CREATE [UNIQUE] [CLUSTER] INDEX <索引名>
ON <表名>(
    <列名> [<次序>] [],
    ...,
);
-- 次序:ASC(升序),DESC(降序)

-- 删除索引名 -- 
DROP INDEX <索引名>

```
-------------
## 查询
```SQL
SELECT [ALL|DISTINCT] <目标列表达式>, ...
FROM <表名或视图名>, ... |(<SELECT 语句) [AS] <别名>
[WHERE <条件表达式>]
[GROUP BY <列名1> [HAVING<条件表达式>]]
[ORDER BY <列名2> [ASC|DESC]];
```
`DISTINCT`能够取出重复元素

`<目标列表达式>`可以是表中的属性列,也可以是表达式,即用不同的列中的元素进行计算,得到的结果作为一个新的列表示
若不定义别名,则列名为表达式本身,如需要定义别名加一个空格后输入别名
也可以是一个常量或者字符串(用' '括起来),这个列的内容就是这个常量或者字符串

### 单表查询：

#### 常用查询条件:
##### 比较: 
同c语言

##### 确定范围
`<列名> BETWEEN <下限> AND <上限>;`,    `NOT BETWEEN AND;`

##### 确定集合
`<列名> [NOT] IN ('<元素名>','<元素名'>,...);`

##### 字符串匹配
`<列名> [NOT] LIKE '<匹配串>' [ESCAPE '<换码字符>']`

    匹配串中可以使用通配符
    %:任意长度的字符串
    _:任意单个字符
如果匹配内容中包含%或者_,则需要用ESCAPE来定义一个换码字符(转义字符)
>这个操作中转义字符是自定义的

##### 空值
`IS NULL` , `IS NOT NULL`

##### 逻辑运算
`AND`, `OR`, `NOT`

#### ORDER BY
```sql
ORDER BY <列名1> [, <列名2>, ...] [DESC]
```
排序, 按照在前面的关键字进行排序, 默认升序, 添加`DESC`关键字则为降序. 

#### 聚集函数
```SQL
COUNT(*)                            --统计元组个数--
COUNT([DISTINCT|ALL] <列名>)        --统计一列中值的个数--
SUM([DISTINCT|ALL] <列名>)          --统计一列中值的综合(值必须为数值类型)--
AVG([DISTINCT|ALL] <列名>)          --统计一列中值的平均(值必须为数值类型)--
MAX([DISTINCT|ALL] <列名>)          --统计一列中值的最大值--
MIN([DISTINCT|ALL] <列名>)          --统计一列中值的最小值--
```
>若指定`DISTINCT`短语, 则表示计算式取消指定列中的重复值, 默认为`ALL`

>聚集函数只能用于`SELECT`子句和`GROUP BY`中的`HAVING`子句

#### GROUP BY子句

将查询得结果按照某一列或多列得值**分组**，值相等的为一组。

	分组后聚集函数将作用与每一个组，即每一组都有一个函数值

`HAVING`语句能够按一定的条件就这些组进行筛选,最终只输出满足指定条件的组

> `WHERE`语句作用与`SELECT`, `HAVING`作用于`GROUP BY`

###  连接查询：

#### 等值与非等值连接查询

*   在`WHERE`操作中使用连接词, 来对两个表或多个表的内容进行连接, 查询值中会有两个表的内容. 相等运算为等值连接, 其他运算为非等值连接

*   若在等值连接中把目标列中重复的属性列去掉则为自然连接

#### 自身连接

自己和自己连接是**自身连接**, 需要为表取两个别名, 使用别名进行

#### 外连接

```sql
LEFT OUTER JOIN <TABLE> ON <条件>
RIGHT OUTER JOIN <TABLE> ON <条件>
```

外连接能够允许第二个次表中某个值为空

