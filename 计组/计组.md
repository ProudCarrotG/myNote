# 第四章 存储系统

##   存储结构

使用双向译码，即纵向一个译码器，横向一个译码器，若想选择存储单元`(x,y)`，需要横向译码器输出第`x`位为高电平, 纵向译码器输出第`y`为为高电平, 满足两个条件才能选择单元`(x, y)`
    
![image-20230516082717578](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516082717578.png)

##   大端方式 小端方式

**1)大端模式：**
低地址 -----------------> 高地址
0x12  |  0x34  |  0x56  |  0x78

**2)小端模式：**

低地址 ------------------> 高地址
0x78  |  0x56  |  0x34  |  0x12

##   存储规格

存储芯片的规格：**m×n** 位

​    **m**：字, 用来描述该芯片可寻址的范围，也可以表述片内译码需要的地址线数量（log2 m）。

>   共m个存储单元

​    **n**：表示该芯片位宽，即一次可读/写的数据位数

##   扩展

>   扩展容量的方法, 可以从3个方面来进行扩展

1.   位扩展

扩展位宽, 即一次可读/写的数据位数. 通过增加存储芯片的个数来实现. 若一个芯片的位宽为`x`, 一个芯片存储数据的低`x`位, 读/写数据时所有芯片同时进行, 再将数据进行组合

存储系统位宽为 `N`位，若使用`k`位芯片，$k<N$，需$(N/k)$个芯片

![image-20230516084407138](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516084407138.png)

2.   字扩展

扩展寻址范围, 通过译码器选择对应的芯片

>   译码器选择芯片称为**片间寻址**
>
>   其他的地址线选择芯片内的存储单元地址称为**片内寻址**

![image-20230516084556853](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516084556853.png)

3.   字位同时扩展

![image-20230516084629876](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516084629876.png)

##   并行主存系统

1.   -   具有两组相互独立的读写控制线路
    
     -   两组读写控制线路可以并行操作

     -   端口地址不相同，无冲突，并行存取

     -   端口地址相同，读写冲突，无法并行存取


​          

![image-20230516085129403](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516085129403.png)

2.   编址方式

![image-20230516085307555](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516085307555.png)

##   相关数据计算

因为引入了并行主存系统的**交叉方式**, 并且因为cpu芯片发送读/写命令后**总线传送命令的传送**需要花费一定的时间, 存储体**接收/发出**数据也需要一定时间; 又因为一个存储体中有多个数据, 而一个存储体同时只能读/写一个数据. 为了缩短读取连续数据**总的**读写时间, cpu的**读/写命令**可以在上一个命令完成后, 未接收数据前**发出**

如图, 图中纵坐标表示读取的**位**, 横坐标表示**时间**, `M`表示**系统中完成一个数据读/写花费的总时间(发送命令+数据接收/发出)**

![image-20230516090005901](https://raw.githubusercontent.com/ProudCarrotG/tuChuang/main/image-20230516090005901.png)

1.    相关变量

      1.    `T`: 模块存取一个字的存储周期
      2.    $\tau$: 总线传送周期
      3.    `m`: 存储体个数
      4.    `n`: 按地址顺序连续读取`n`个字
      5.    `w`: 位

2.    计算

      1.    按地址顺序连续读取`n`个字, **交叉**存储器需要的时间:
            $$
            t_{交} = T+(n-1)\tau
            $$

      2.    按地址顺序连续读取`n`个字, **顺序**存储器需要的时间:

      $$
      t_{顺} = nT
      $$

      3.   交叉存储度: $T/\tau$

## 带宽

一个存储周期中, 能够传输的信息总量的速率

1.   按**地址顺序**连续读`n`个字, 传递的信息总量为

$$
q= w*n
$$

2.   带宽
     $$
     W_{顺}=\frac{q}{t_{顺}}=\frac{w*n}{nT} = \frac{w}{T}\\
     W_{交}=\frac{q}{t_{交}}=\frac{w×n}{(T+(n-1)τ)}
     $$

## 高速缓冲存储器(Cache)

 容量小, 但速度比主存高得多, 介于`cpu`与`主存`之间. 它是为了**解决CPU和主存之间速度不匹配**而采用的一项重要技术。

>   分块: 将主存中连续的一定长度的地址区分开称为块

**Cache**与主存之间的**数据交换是以块为单位**。即一次性将主存中一段连续的数据放入**Cache**中

-   命中: 若**cpu**需要读取的数据在Cache中存在, 则为命中(`hit`), 否则为未命中(`miss`)
